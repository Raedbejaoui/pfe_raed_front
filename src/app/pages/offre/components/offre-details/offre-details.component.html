<!-- Start Breadcrumbs -->
<app-breadcrumbs title="Product Overview" [breadcrumbItems]="breadCrumbItems"></app-breadcrumbs>
<!-- End Breadcrumbs -->

<div class="row">
  <div class="col-xxl-4">
    <div class="card p-3 sticky-side-div">
      <div class="product-img-slider">
        <ngx-slick-carousel class="carousel swiper product-thumbnail-slider p-2 rounded bg-light custom-arrow" [config]="slideConfig" #slickModal="slick-carousel" (afterChange)="slickChange($event)">
          @for (i of productdetail.image; track $index) {
          <div ngxSlickItem class="slide">
              <div class="p-5 mx-4">
                  <img src="{{i}}" alt="" class="img-fluid d-block">
                        </div>
                    </div>
          }
        </ngx-slick-carousel>

        <!-- end swiper thumbnail slide -->
        <ngx-slick-carousel class="carousel swiper product-nav-slider mt-2" [config]="slidesConfig">
          @for (i of productdetail.image; track $index) {
          <div ngxSlickItem class="swiper-slide swiperlist me-2" (click)="slidePreview($index,$event)">
              <div class="nav-slide-item">
                  <img src="{{i}}" alt="" class="img-fluid d-block">
                        </div>
                    </div>
          }
        </ngx-slick-carousel>
      </div>
      <!-- end swiper nav slide -->
    </div>
  </div>
  <div class="col-xxl-8">
    <div class="row g-0">
      <div class="col-xxl-8">
        <div class="card rounded-end-0">
          <div class="card-body p-4">
            <p class="text-muted float-md-end mb-md-0"><a href="javascript:void(0);"><i class="ph-storefront align-middle me-1"></i> Visit Store</a></p>
            <h4 class="text-capitalize mb-3">{{offerDetails?.title}}</h4>
            <div class="hstack gap-3 flex-wrap mb-4">
              <div class="text-muted">Date de creation :<b class="text-body fw-medium">{{formatDate(offerDetails?.creationDate)}}</b></div>
              <div class="vr"></div>
            </div>
            <div>
              <h5 class="fs-md mb-3">Description:</h5>
              <p class="text-muted mb-2">{{offerDetails?.description }}</p>
            </div>
          </div>
         <div class="mt-4">
            <!--<h5 class="fs-md mb-3">Product Details:</h5>-->
            <div class="table-responsive">
             <!-- <table class="table table-sm table-borderless align-middle description-table mb-0">
                <tbody>
                <tr>
                  <th>Type</th>
                  <td>Stripped shirts</td>
                </tr>
                <tr>
                  <th>Sleeve</th>
                  <td>Full Sleeve</td>
                </tr>
                <tr>
                  <th>Country of Origin</th>
                  <td>California</td>
                </tr>
                <tr>
                  <th>Pack of</th>
                  <td>1</td>
                </tr>
                <tr>
                  <th>Style</th>
                  <td>Modern</td>
                </tr>
                <tr>
                  <th>Style Code</th>
                  <td>TBS037</td>
                </tr>
                <tr>
                  <th>Generic Name</th>
                  <td>Formal Shirt</td>
                </tr>
                <tr>
                  <th>Ideal For</th>
                  <td>Men</td>
                </tr>
                <tr>
                  <th>Size</th>
                  <td>All Available</td>
                </tr>
                <tr>
                  <th>Suitable For</th>
                  <td>Formal Wear,Party Wear</td>
                </tr>
                <tr>
                  <th>Seller</th>
                  <td>Zibra Fashion</td>
                </tr>
                <tr>
                  <th>Fabric</th>
                  <td>Cotton</td>
                </tr>
                </tbody>
              </table> -->
            </div>
          </div>
        </div>
      </div>
      <div class="col-xxl-4">
        <div class="card card-height-100 border-start rounded-start-0">
          <div class="card-body p-4">
            <div class="row">
              <div class="col-lg-12">
                <div class="card card-primary">
                  <div class="card-body d-flex align-items-center flex-wrap gap-2">
                    <div class="flex-grow-1">
                      <h5 class="card-title text-white fs-xl">{{offerDetails?.offerStatus}}</h5>
                   <p class="mb-0 text-white-50"></p>
                    </div>
                    <div class="flex-shrink-0">
                      <button type="button" class="btn btn-secondary">{{formatDate(offerDetails?.deadLine)}}</button>
                    </div>
                  </div>
                </div>
              </div><!--end col-->
             <!-- <div class="col-lg-12">
                <div class="row g-3">
                  <div class="col-md-6">
                    <div class="card border shadow-none mb-0">
                      <div class="card-body p-2">
                        <div class="text-center">
                          <p class="text-muted text-truncate mb-2">PRICE</p>
                          <h6 class="fs-lg">$245.99</h6>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="card border shadow-none mb-0">
                      <div class="card-body p-2">
                        <div class="text-center">
                          <p class="text-muted text-truncate mb-2">No. of Orders</p>
                          <h6 class="fs-lg">3.7k</h6>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="card border shadow-none mb-0">
                      <div class="card-body p-2">
                        <div class="text-center">
                          <p class="text-muted text-truncate mb-2">Available Stocks</p>
                          <h6 class="fs-lg">764</h6>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="card border shadow-none mb-0">
                      <div class="card-body p-2">
                        <div class="text-center">
                          <p class="text-muted text-truncate mb-2">Total Revenue</p>
                          <h6 class="fs-lg">$59,239</h6>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div> -->
            </div><!--end row-->
            <div class="mt-4" *ngIf="isCurrentUserOwner()">
              <button type="button" class="btn btn-primary" (click)="editOffer(offerDetails)">Edit Offer</button>
              <button type="button" class="btn btn-danger w-100" (click)="confirmDelete()"><i class="ph-trash align-middle me-1"></i>Delete</button>
            </div>
            <div class="mt-4" *ngIf="isEnterpriseUser()">
              <button type="button" class="btn btn-primary" (click)="openReplyModal()">Add Reply</button>
            </div>
          </div>
        </div><!--end col-->
      </div><!--end col-->
    </div><!--end row-->
    <div class="card">
      <div class="card-body p-4">
        <div *ngIf="isCurrentUserOwner()" class="replies-section">
          <h3>Replies</h3>
          <div *ngIf="offerDetails.replies.length > 0; else noReplies">
            <div *ngFor="let reply of offerDetails.replies" class="reply">
              <div class="reply-header">
                <strong>{{ reply.user.name }}</strong>
              </div>
              <p *ngIf="reply.text">{{ reply.text }}</p>
              <!-- Check if the reply has a file attachment -->
              <div *ngIf="reply.filePath" class="file-attachment">
                <!-- Determine file type and display accordingly -->
                <ng-container *ngIf="isImage(reply.filePath); then imageContent; else pdfContent"></ng-container>
                <ng-template #imageContent>
                  <a [href]="reply.filePath" target="_blank">
                    <img [src]="reply.filePath" alt="Image Attachment" class="img-fluid">
                  </a>

                  <a [href]="reply.filePath" target="_blank" class="btn btn-primary" download="file">Download image</a>
                </ng-template>
                <ng-template #pdfContent>
                  <a [href]="reply.filePath" target="_blank" class="btn btn-primary" download="file">Download PDF</a>
                </ng-template>
              </div>
            </div>
          </div>
          <ng-template #noReplies>
            <p>No replies yet.</p>
          </ng-template>
        </div>
      </div>
    </div>
  </div><!--end col-->
</div><!--end row-->

<div class="row">
  <div class="col-lg-12">
    <div class="card">
      <div class="card-header d-flex flex-wrap align-items-center gap-3 mb-2">
        <div class="flex-shrink-0">
        </div>
        <div class="flex-shrink-0">
         <!-- <button type="button" class="btn btn-primary" (click)="addReply.show()"><i class="ph-plus-circle align-middle me-1"></i> Add Reply</button> -->
        </div>
      </div>
    </div>
  </div><!--end col-->
</div><!--end row-->
<!-- addReview Modal -->
<div bsModal #addReview="bs-modal" class="modal fade">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="addReviewLabel">Add Review</h1>
        <button type="button" class="btn-close" id="review-close" (click)="addReview.hide()"></button>
      </div>
      <form (ngSubmit)="saveReview()" [formGroup]="reviewForm" class="tablelist-form" novalidate autocomplete="off">
        <div class="modal-body">
          <div id="alert-error-msg" class="d-none alert alert-danger py-2"></div>
          <input type="hidden" id="id-field">
          <div class="mb-3">
            <label class="form-label d-block">Select Review <span class="text-danger">*</span></label>
            <div id="basic-rater" dir="ltr">
              <rating style="color: #f6b749;font-size: 25px;" formControlName="rate" [max]="5" [readonly]="false"></rating>
            </div>
          </div>
          <div class="mb-3">
            <label for="reviewTitle-input" class="form-label">Review Title <span class="text-danger">*</span></label>
            <input type="text" class="form-control" formControlName="title" id="reviewTitle-input" placeholder="Title" required>
          </div>
          <div class="mb-3">
            <label for="reviewDesc-input" class="form-label">Review <span class="text-danger">*</span></label>
            <textarea class="form-control" id="reviewDesc-input" formControlName="content" rows="4" placeholder="Enter review" required></textarea>
          </div>
          <div>
            <label class="form-label">Product Images</label>
            <dropzone class="dropzone" [config]="dropzoneConfig" [message]="'Drop files here or click to upload.'" (success)="onUploadSuccess($event)"></dropzone>

            @if (uploadedFiles) {
            <ul class="list-unstyled mb-0" id="dropzone-preview">
                @for (file of uploadedFiles; track $index) {
            <li class="mt-2" id="dropzone-preview-list">
              <div class="border rounded">
                <div class="d-flex p-2">
                  <div class="flex-shrink-0 me-3">
                    <div class="avatar-sm bg-light rounded p-2">
                      @if (file.dataURL) {
                      <img class="img-fluid rounded d-block" [src]="file.dataURL" alt="Dropzone-Image" />
                      }@else{
                      <img class="img-fluid rounded d-block" [src]="file" alt="Dropzone-Image" />
                      }
                    </div>
                  </div>
                  <div class="flex-grow-1">
                    <div class="pt-1">
                      @if (file.name) {<h5 class="fs-md mb-1">{{ file.name }}</h5>}
                      @if (file.size) {<p class="fs-sm text-muted mb-0">{{ file.size }}</p>}
                    </div>
                  </div>
                  <div class="flex-shrink-0 ms-3">
                    <button (click)="removeFile(file)" class="btn btn-sm btn-danger">Delete</button>
                  </div>
                </div>
              </div>
            </li>
            }
            </ul>
            }
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-ghost-danger" (click)="addReview.hide()"><i class="ph-x align-middle me-1"></i> Close</button>
          <button type="submit" class="btn btn-primary">Add Review</button>
        </div>
      </form>
    </div>
  </div>
</div>


<!-- removeItemModal -->
<div bsModal #removeItemModal="bs-modal" id="removeItemModal" class="modal fade zoomIn">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="btn-close" (click)="removeItemModal.hide()"></button>
      </div>
      <div class="modal-body">
        <div class="text-center">
          <div class="text-danger">
            <i class="bi bi-trash display-4"></i>
          </div>
          <div class="mt-4 fs-base">
            <h4 class="mb-1">Are you sure ?</h4>
            <p class="text-muted mx-4 mb-0">Are you sure you want to remove this product?</p>
          </div>
        </div>
        <div class="d-flex gap-2 justify-content-center mt-4 mb-2">
          <button type="button" class="btn w-sm btn-light" (click)="removeItemModal.hide()">Close</button>
          <button type="button" class="btn w-sm btn-danger" id="remove-product" (click)="deleteProduct()">Yes, Delete It!</button>
        </div>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<ng-template #editOfferModalTemplate>
  <div class="modal-header">
    <h1 class="modal-title fs-5">Edit Offer</h1>
    <button type="button" class="btn-close" (click)="editModalRef?.hide()"></button>
  </div>
  <div class="modal-body">
    <!-- Your form to edit offer details -->
    <div class="mb-3">
      <label for="title-input" class="form-label">Title</label>
      <input type="text" class="form-control" id="title-input" [(ngModel)]="editedOffer.title">
    </div>
    <div class="mb-3">
      <label for="title-input" class="form-label">Description</label>
      <input type="text" class="form-control" id="description-input" [(ngModel)]="editedOffer.description">
    </div>
    <!-- Add other form fields here -->
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="editModalRef?.hide()">Close</button>
    <button type="button" class="btn btn-primary" (click)="saveEditedOffer()">Save changes</button>
  </div>
</ng-template>


<!-- addReply Modal -->
<div bsModal #addReply="bs-modal" class="modal fade">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="addReplyLabel">Add Reply</h1>
        <button type="button" class="btn-close" (click)="addReply.hide()"></button>
      </div>
      <form (ngSubmit)="saveReply()" [formGroup]="replyForm" class="tablelist-form" novalidate autocomplete="off">
        <div class="modal-body">
          <div id="alert-error-msg" class="d-none alert alert-danger py-2"></div>
          <input type="hidden" id="id-field">
          <div class="mb-3">
            <label for="replyText-input" class="form-label">Reply Text <span class="text-danger">*</span></label>
            <textarea class="form-control" id="replyText-input" formControlName="text" rows="4" placeholder="Enter reply" required></textarea>
          </div>
          <div>
            <label class="form-label">Attach File</label>
            <dropzone class="dropzone" [config]="dropzoneConfig" (success)="onUploadSuccess($event)"></dropzone>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-ghost-danger" (click)="addReply.hide()"><i class="ph-x align-middle me-1"></i> Close</button>
          <button type="submit" class="btn btn-primary">Submit Reply</button>
        </div>
      </form>
    </div>
  </div>
</div>
